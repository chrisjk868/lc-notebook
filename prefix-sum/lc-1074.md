# 1074. Number of Submatrices That Sum to Target
***Topics***: *Prefix Sum, Matrix*  
***Difficulty***: <span style="color: #f8615c;">Hard</span>

---
Given a ```matrix``` and a ```target```, return the number of non-empty submatrices that sum to target.  
A submatrix ```x1, y1, x2, y2``` is the set of all cells ```matrix[x][y]``` with ```x1 <= x <= x2``` and ```y1 <= y <= y2```.  
Two submatrices ```(x1, y1, x2, y2)``` and ```(x1', y1', x2', y2')``` are different if they have some coordinate that is different: for example, if ```x1 != x1'```.  

---
**Example 1:**  

![example 1](https://assets.leetcode.com/uploads/2020/09/02/mate1.jpg)

Input: ```matrix = [[0,1,0],[1,1,1],[0,1,0]], target = 0```  
Output: ```4```  
Explanation: ```The four 1x1 submatrices that only contain 0.```  

**Example 2:**

Input: ```matrix = [[1,-1],[-1,1]], target = 0```  
Output: ```5```  
Explanation: ```The two 1x2 submatrices, plus the two 2x1 submatrices, plus the 2x2 submatrix.```  

**Example 3:**

Input: ```matrix = [[904]], target = 0```  
Output: ```0```  
Explanation: ```The one 1x1 submatrix that only contain 0.```  

---
## Intuition

---
## Implementation

---
## Solution
```python
def numSubmatrixSumTarget(self, matrix: List[List[int]], target: int) -> int:
    ans = 0
    R, C = len(matrix), len(matrix[0])
    h_sum, ps = [[0 for i in range(C)] for j in range(R)], \
                    [[0 for i in range(C)] for j in range(R)]
    for r in range(R):
        for c in range(C):
                h_sum[r][c] = matrix[r][c] + (0 if c == 0 else h_sum[r][c - 1])
                ps[r][c] = h_sum[r][c] + (0 if r == 0 else ps[r - 1][c])
    
    # Iterate through the prefix sum matrix and tally total subarrays to sum to target:
    # If we fix the algorithm by rows
    for r1 in range(R):
        for r2 in range(r1, R):
            sum_occurences = {0: 1}
            for c in range(C):
                curr_sum = ps[r2][c] - (0 if r1 == 0 else ps[r1 - 1][c])
                valid_sum = curr_sum - target
                if valid_sum in sum_occurences:
                    ans += sum_occurences[valid_sum]
                if curr_sum in sum_occurences:
                    sum_occurences[curr_sum] += 1
                else:
                    sum_occurences[curr_sum] = 1
    return ans
```
---
## Runtime & Space Complexity
[analysis here]

---
## Code Performance
[performance]

---